<%- include("partials/sidebar") %>

  <section class="content--body appmain" data-id="<%=trip[0]._id%>">
    <!-- Editable Trip Cover Image -->
    <section class="trip--cover">
      <img class="trip--coverImg" src="<%= trip[0].displayImg %>" alt="">

      <section class="changeCoverImg" data-id="<%=trip[0]._id%>">
        <input class="changeCoverImg-input" type="text" name="displayImg" placeholder="enter URL"><button class="changeCoverImg-btn">Change Cover</button>
      </section>
    </section>

    <!-- Trip Title -->
    <h1 class="trip--title editable" contenteditable="true"><%= trip[0].trip %></h1>
    
    <!-- Trip Overview Section -->
    <section class="trip--overview">
      <section class="overview--details">
        <span class="detail--title">
          <i class="fa-solid fa-user-group"></i> Travelers: </span>
          <!-- Gets all usernames from sharedUsers Object -->
        <span class="detail--value"><%= trip[0].sharedUsers.map(user => Object.values(user)) %></span>
      </section>
      <section class="overview--details">
        <span class="detail--title">
          <i class="fa-solid fa-clock"></i> Created: </span>
          <!-- Formats and gets the date trip was created -->
        <span class="detail--value"><%= trip[0].creationDate.toDateString() %></span>
      </section>
      <section class="overview--details">
        <span class="detail--title">
          <i class="fa-solid fa-location-dot"></i> Stops: </span>
          <!-- Calculates the total number of trip destinations -->
        <span class="detail--value"><%= trip[0].destinations.length %></span>
      </section>
      <section class="overview--details">
        <span class="detail--title">
          <i class="fa-solid fa-calendar-day"></i> Travel Dates: </span>
        <span class="detail--value">
          <% if (trip[0].destinations.length >= 1) { %>
            <!-- Get Earliest Start Date by sorted array at 0th position-->
            <span><%= trip[0].destinations.sort((a,b) => (a.startDate > b.startDate) ? 1 : -1)[0].startDate %> → </span>  
            <!-- Get Latest End Date by sorted array at end position -->
            <span><%= trip[0].destinations.sort((a,b) => (a.startDate > b.startDate) ? 1 : -1)[trip[0].destinations.length - 1].endDate %></span>  
          <% } %>
        </span>
      </section>
    </section>

    <!-- Editable Trip Description -->
    <p class="trip--description editable" contenteditable="true"><%= trip[0].description ? trip[0].description : 'Enter trip description...' %></p> 

    <!-- Trip Destination Card Template EJS -->
    <section class="trip--destinations">
      <h3 class="destination--title">Destinations</h3>

      <!-- Add new destination components -->
      <section class="newDestination" data-id="<%=trip[0]._id%>">
        <input class="newDestination--input" type="text" name="newDestination" placeholder="Enter New Destination">
        <button class="newDestination--btn"> Add Destination </button>
      </section>

      <!-- Render destination cards if available -->
      <% if (trip[0].destinations) { %>

        <% trip[0].destinations.sort((a,b) => (a.startDate > b.startDate) ? 1 : -1).map(destination => { %>
          <section class="newDestination--item" data-id="<%=trip[0]._id%>" >
            <!-- Card Icon -->
            <section class="newDestination--icon" data-id="<%=trip[0]._id%>">
              <i class="fa-solid fa-plane"></i>
            </section>

            <!-- Editable Card Information -->
            <section class="newDestination--info" data-id="<%=trip[0]._id%>" >
              <!-- Location -->
              <h4 class="newDestination--location editable" contenteditable="true"> <%= destination.location %> </h4> 
              <!-- Start - End Dates -->
              <section class="newDestination--dates" data-id="<%=trip[0]._id%>" data-loc="<%= destination.location %>">
                <input class="destination--startDate" type="date" name="destination--startDate" id="" value="<%= destination.startDate %>">
                <input class="destination--endDate" type="date" 
                name="destination--endDate" id="" value="<%= destination.endDate %>">
                <!-- <% if (destination.startDate && destination.endDate) { %>
                  <section>
                    <span><%= destination.startDate.split('-').join('.') %></span> → 
                    <span><%= destination.endDate.split('-').join('.') %></span>
                  </section>
                <% } %> -->
              </section>
            </section>

            <!-- Card Btns -->
            <section class="newDestination--btns" data-id="<%=trip[0]._id%>" data-loc="<%= destination.location %>" >
              <a href="#<%= destination.location %>"><i class="editDestination--btn fa-solid fa-expand"></i></a>
              <i class="deleteDestination--btn fa-solid fa-trash-can"></i>
            </section>
          </section>

          <!-- Destination Expanded Modal -->
          <section id="<%= destination.location %>" class="modal expanded">
            <section class="modal--content expanded">
              <!-- Location -->
              <h2 class="newDestination--location editable" contenteditable="true"><%= destination.location %></h2>

              <!-- Start - End Dates -->
              <section class="newDestination--dates" data-id="<%=trip[0]._id%>" data-loc="<%= destination.location %>">
                <input class="destination--startDate" type="date" name="destination--startDate" id="" value="<%= destination.startDate %>">
                <input class="destination--endDate" type="date" 
                name="destination--endDate" id="" value="<%= destination.endDate %>">
              </section>

              <!-- Editable Notes -->
              <p class="destination--notes editable" contenteditable="true"><%= destination.description ? destination.description : "Add notes..." %></p>

              <!-- Destination Content Tabs -->
              <section class="content--nav">
                <button class="content--tabs active">Summary</button>
                <button class="content--tabs">Itinerary</button>
                <button class="content--tabs">Flights/Travel</button>
                <button class="content--tabs">Accomodations</button>
              </section>

              <!-- Close Modal Btn -->
              <a href="#" class="modal--close">&times;</a>
            </section>
          </section>

        <% }) %>
      <% } %>

    </section>
    
  </section>
  <script src="/js/main.js"></script>
  </body>
</html>